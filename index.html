<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì¼€ë¥¼ ë³´ë‹¤ (Sake View)</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #2c5282 0%, #8b4513 100%);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s, color 0.3s;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
        }

        .container { max-width: 1000px; margin: 0 auto; }

        .header {
            text-align: center;
            color: white;
            padding: 40px 20px;
            position: relative;
            margin-bottom: 30px;
        }

        .header h1 { font-size: 3em; font-weight: 900; letter-spacing: 2px; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }

        .theme-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            padding: 10px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.3em;
        }

        .auth-container { background: white; padding: 30px; border-radius: 10px; margin-bottom: 20px; }
        .auth-form { max-width: 400px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #333; }
        .form-group input, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: inherit; }
        .form-group textarea { resize: vertical; min-height: 80px; }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary { background: #2c5282; color: white; width: 100%; }
        .btn-primary:hover { background: #1a3a5c; }

        .btn-secondary { background: #999; color: white; margin-right: 10px; }
        .btn-secondary:hover { background: #777; }

        .btn-small { padding: 8px 16px; font-size: 0.9em; margin-right: 5px; margin-bottom: 10px; }

        .edit-btn { background: #4CAF50; color: white; }
        .edit-btn:hover { background: #45a049; }

        .delete-btn { background: #f44336; color: white; }
        .delete-btn:hover { background: #da190b; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { padding: 12px 24px; background: rgba(255,255,255,0.3); color: white; border: none; cursor: pointer; border-radius: 5px; font-weight: 600; }
        .tab.active { background: white; color: #2c5282; }

        .content { background: white; padding: 30px; border-radius: 10px; }
        .view { display: none; }
        .view.active { display: block; }

        .form-section { margin-bottom: 30px; }
        .section-title { font-size: 1.3em; font-weight: 700; margin-bottom: 15px; color: #2c5282; border-bottom: 2px solid #2c5282; padding-bottom: 10px; }

        .rating-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .rating-item { }
        .rating-item label { display: block; font-weight: 600; margin-bottom: 10px; color: #333; }
        .rating-scale { display: flex; gap: 10px; }
        .rating-scale label { display: flex; align-items: center; gap: 5px; margin: 0; font-weight: normal; cursor: pointer; }
        .rating-scale input { margin: 0; }

        .note-card { background: #f5f5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #2c5282; cursor: pointer; margin-bottom: 10px; transition: all 0.3s; }
        .note-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .note-card-title { font-weight: 700; color: #2c5282; margin-bottom: 5px; }
        .note-card-date { font-size: 0.9em; color: #666; }

        .detail-section { margin-bottom: 20px; }
        .detail-label { font-weight: 700; color: #2c5282; margin-bottom: 8px; }
        .detail-value { color: #333; line-height: 1.6; }

        .rating-display { display: flex; gap: 5px; flex-wrap: wrap; }
        .rating-display span { background: #e0e0e0; padding: 5px 10px; border-radius: 20px; font-size: 0.9em; }

        .empty-state { text-align: center; padding: 40px; color: #999; }
        .empty-state-icon { font-size: 3em; margin-bottom: 10px; }

        .photo-preview { max-width: 100%; height: auto; border-radius: 8px; margin-top: 10px; }

        .rating-slider-container { margin: 15px 0; }
        .slider-labels { display: flex; justify-content: space-between; font-size: 0.85em; color: #666; position: relative; top: -20px; }
        .slider { width: 100%; height: 6px; border-radius: 3px; background: #e0e0e0; outline: none; -webkit-appearance: none; appearance: none; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; border-radius: 50%; background: linear-gradient(135deg, #2c5282 0%, #8b4513 100%); cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .slider::-moz-range-thumb { width: 16px; height: 16px; border-radius: 50%; background: linear-gradient(135deg, #2c5282 0%, #8b4513 100%); cursor: pointer; border: none; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

        .rating-display-value { text-align: center; font-size: 1.2em; font-weight: bold; color: #2c5282; margin-top: 10px; }

        .photo-upload { border: 2px dashed #2c5282; padding: 20px; text-align: center; border-radius: 8px; cursor: pointer; background: #f9f9f9; }
        .photo-upload:hover { background: #f0f0f0; }

        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .rating-grid { grid-template-columns: 1fr; }
            .content { padding: 20px; }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">â˜€ï¸</button>
        <h1>ì‚¬ì¼€ë¥¼ ë³´ë‹¤</h1>
        <p>ì‚¬ì¼€ í…Œì´ìŠ¤íŒ… ë…¸íŠ¸ & ë¶„ì„</p>
    </div>

    <div class="auth-container" id="authContainer" style="display: none;">
        <div class="auth-form">
            <h2 style="text-align: center; margin-bottom: 20px;">ë¡œê·¸ì¸</h2>
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="loginEmail" placeholder="ì´ë©”ì¼">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
            </div>
            <button class="btn btn-primary" onclick="handleLogin()">ë¡œê·¸ì¸</button>
            <div style="text-align: center; margin-top: 10px;">
                <a onclick="showSignup()" style="cursor: pointer; color: #2c5282;">íšŒì›ê°€ì…</a>
            </div>
        </div>
    </div>

    <div id="appContainer" style="display: none;">
        <div style="text-align: right; margin-bottom: 20px;">
            <span id="userEmail" style="color: white; margin-right: 20px;"></span>
            <button class="btn btn-secondary" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('new')">ìƒˆ ë…¸íŠ¸</button>
            <button class="tab" onclick="switchTab('list')">ì €ì¥ëœ ë…¸íŠ¸</button>
        </div>

        <div class="content">
            <!-- ìƒˆ ë…¸íŠ¸ ì‘ì„± -->
            <div id="newTab" class="view active">
                <form id="tastingForm" onsubmit="saveTastingNote(event)">
                    <div class="form-section">
                        <div class="section-title">ê¸°ë³¸ ì •ë³´</div>
                        <div class="form-group">
                            <label>ë‚ ì§œ</label>
                            <input type="date" id="date">
                        </div>
                        <div class="form-group">
                            <label>ì‚¬ì¼€ ì´ë¦„</label>
                            <input type="text" id="sakeName" placeholder="ì˜ˆ: ì„¼í‚¨ ì•„ì´ì¿ ë‹ˆ">
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="section-title">ì™¸ê´€</div>
                        <div class="rating-grid">
                            <div class="rating-item">
                                <label>ìƒ‰ê°</label>
                                <div class="rating-scale">
                                    <label><input type="radio" name="clarity_rating" value="1"> 1</label>
                                    <label><input type="radio" name="clarity_rating" value="2"> 2</label>
                                    <label><input type="radio" name="clarity_rating" value="3" checked> 3</label>
                                    <label><input type="radio" name="clarity_rating" value="4"> 4</label>
                                    <label><input type="radio" name="clarity_rating" value="5"> 5</label>
                                </div>
                            </div>
                            <div class="rating-item">
                                <label>íˆ¬ëª…ë„</label>
                                <div class="rating-scale">
                                    <label><input type="radio" name="transparency" value="1"> 1</label>
                                    <label><input type="radio" name="transparency" value="2"> 2</label>
                                    <label><input type="radio" name="transparency" value="3" checked> 3</label>
                                    <label><input type="radio" name="transparency" value="4"> 4</label>
                                    <label><input type="radio" name="transparency" value="5"> 5</label>
                                </div>
                            </div>
                            <div class="rating-item">
                                <label>ì ë„</label>
                                <div class="rating-scale">
                                    <label><input type="radio" name="viscosity" value="1"> 1</label>
                                    <label><input type="radio" name="viscosity" value="2"> 2</label>
                                    <label><input type="radio" name="viscosity" value="3" checked> 3</label>
                                    <label><input type="radio" name="viscosity" value="4"> 4</label>
                                    <label><input type="radio" name="viscosity" value="5"> 5</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="section-title">í–¥ê¸°</div>
                        <div class="rating-grid">
                            <div class="rating-item">
                                <label>í–¥ ê°•ë„</label>
                                <div class="rating-scale">
                                    <label><input type="radio" name="aroma_intensity" value="1"> 1</label>
                                    <label><input type="radio" name="aroma_intensity" value="2"> 2</label>
                                    <label><input type="radio" name="aroma_intensity" value="3" checked> 3</label>
                                    <label><input type="radio" name="aroma_intensity" value="4"> 4</label>
                                    <label><input type="radio" name="aroma_intensity" value="5"> 5</label>
                                </div>
                            </div>
                            <div class="rating-item">
                                <label>í–¥ ë³µí•©ë„</label>
                                <div class="rating-scale">
                                    <label><input type="radio" name="complexity_aroma" value="1"> 1</label>
                                    <label><input type="radio" name="complexity_aroma" value="2"> 2</label>
                                    <label><input type="radio" name="complexity_aroma" value="3" checked> 3</label>
                                    <label><input type="radio" name="complexity_aroma" value="4"> 4</label>
                                    <label><input type="radio" name="complexity_aroma" value="5"> 5</label>
                                </div>
                            </div>
                            <div class="rating-item">
                                <label>í–¥ ì„ ëª…ë„</label>
                                <div class="rating-scale">
                                    <label><input type="radio" name="sharpness" value="1"> 1</label>
                                    <label><input type="radio" name="sharpness" value="2"> 2</label>
                                    <label><input type="radio" name="sharpness" value="3" checked> 3</label>
                                    <label><input type="radio" name="sharpness" value="4"> 4</label>
                                    <label><input type="radio" name="sharpness" value="5"> 5</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ì£¼ì²´ê°€ ë˜ëŠ” í–¥</label>
                                <input type="text" id="dominant_aroma" placeholder="ì˜ˆ: ì€ì€í•œ ì‚¬ê³¼ í–¥">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="section-title">ë§›</div>
                        <div class="rating-grid">
                            <div class="rating-item">
                                <label>ë§›ì˜ ê°•ë„</label>
                                <div class="rating-scale">
                                    <label><input type="radio" name="flavor" value="1"> 1</label>
                                    <label><input type="radio" name="flavor" value="2"> 2</label>
                                    <label><input type="radio" name="flavor" value="3" checked> 3</label>
                                    <label><input type="radio" name="flavor" value="4"> 4</label>
                                    <label><input type="radio" name="flavor" value="5"> 5</label>
                                </div>
                            </div>
                            <div class="rating-item">
                                <label>ë§› ë³µí•©ë„</label>
                                <div class="rating-scale">
                                    <label><input type="radio" name="complexity_taste" value="1"> 1</label>
                                    <label><input type="radio" name="complexity_taste" value="2"> 2</label>
                                    <label><input type="radio" name="complexity_taste" value="3" checked> 3</label>
                                    <label><input type="radio" name="complexity_taste" value="4"> 4</label>
                                    <label><input type="radio" name="complexity_taste" value="5"> 5</label>
                                </div>
                            </div>
                            <div class="rating-item">
                                <label>ì‚°ë¯¸</label>
                                <div class="rating-scale">
                                    <label><input type="radio" name="acidity" value="1"> 1</label>
                                    <label><input type="radio" name="acidity" value="2"> 2</label>
                                    <label><input type="radio" name="acidity" value="3" checked> 3</label>
                                    <label><input type="radio" name="acidity" value="4"> 4</label>
                                    <label><input type="radio" name="acidity" value="5"> 5</label>
                                </div>
                            </div>
                            <div class="rating-item">
                                <label>ì—¬ìš´</label>
                                <div class="rating-scale">
                                    <label><input type="radio" name="aftertaste" value="1"> 1</label>
                                    <label><input type="radio" name="aftertaste" value="2"> 2</label>
                                    <label><input type="radio" name="aftertaste" value="3" checked> 3</label>
                                    <label><input type="radio" name="aftertaste" value="4"> 4</label>
                                    <label><input type="radio" name="aftertaste" value="5"> 5</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ì£¼ì²´ê°€ ë˜ëŠ” ë§›</label>
                                <input type="text" id="dominant_taste" placeholder="ì˜ˆ: ë¶€ë“œëŸ¬ìš´ ë‹¨ë§›">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="section-title">í–¥ë¯¸ ì„¤ëª…</div>
                        <div class="form-group">
                            <label>í–¥ë¯¸ì— ê´€í•œ ì„œìˆ </label>
                            <textarea id="flavor_description" placeholder="ì „ë°˜ì ì¸ ì¸ìƒê³¼ íŠ¹ì§•ì„ ê¸°ë¡í•˜ì„¸ìš”"></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="section-title">ê°œì¸ì ì¸ ê°ìƒí‰</div>
                        <div class="form-group">
                            <label>ê°ìƒí‰</label>
                            <textarea id="personal_review" placeholder="ê°œì¸ì ì¸ ìƒê°ê³¼ ì¬êµ¬ë§¤ ì˜í–¥ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                        </div>
                        <div class="rating-slider-container">
                            <label>í‰ì  (1-10)</label>
                            <div class="slider-labels">
                                <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
                            </div>
                            <input type="range" id="overall_rating" min="1" max="10" value="5" class="slider">
                            <div class="rating-display-value"><span id="ratingDisplay">5</span> / 10</div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
                </form>
            </div>

            <!-- ì €ì¥ëœ ë…¸íŠ¸ ëª©ë¡ -->
            <div id="listTab" class="view">
                <div id="notesList"></div>
            </div>

            <!-- ìƒì„¸ ë³´ê¸° -->
            <div id="detailTab" class="view">
                <button class="btn btn-secondary" onclick="switchTab('list')">â† ëª©ë¡ìœ¼ë¡œ</button>
                <div id="detailContent" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>
</div>

<script>
const SUPABASE_URL = 'https://atgfrwohilgucmheyuzu.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF0Z2Zyd29oaWxndWNtaGV5dXp1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NjAyNTUsImV4cCI6MjA4NTIzNjI1NX0.CoyHTds_3BRl5p6wAehlqaevrdkqp1BzymnTnqhzy2Y';

const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentUser = null;
let editingNoteId = null;

document.getElementById('overall_rating').addEventListener('input', function() {
    document.getElementById('ratingDisplay').textContent = this.value;
});

function setDefaultDate() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date').value = today;
}

async function handleLogin() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    if (!email || !password) {
        alert('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
        return;
    }

    try {
        const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
        if (error) throw error;
        
        currentUser = data.user;
        showApp();
    } catch (error) {
        alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message);
    }
}

async function handleLogout() {
    await supabaseClient.auth.signOut();
    currentUser = null;
    showAuth();
}

function showAuth() {
    document.getElementById('authContainer').style.display = 'block';
    document.getElementById('appContainer').style.display = 'none';
}

function showApp() {
    document.getElementById('authContainer').style.display = 'none';
    document.getElementById('appContainer').style.display = 'block';
    document.getElementById('userEmail').textContent = currentUser.email;
    setDefaultDate();
    loadNotes();
}

function showSignup() {
    const email = prompt('ìƒˆ ê³„ì • ì´ë©”ì¼:');
    if (!email) return;
    const password = prompt('ë¹„ë°€ë²ˆí˜¸:');
    if (!password) return;

    supabaseClient.auth.signUp({ email, password }).then(({ data, error }) => {
        if (error) {
            alert('íšŒì›ê°€ì… ì‹¤íŒ¨: ' + error.message);
        } else {
            alert('íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
            document.getElementById('loginEmail').value = email;
        }
    });
}

function switchTab(tabName) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tabName + 'Tab').classList.add('active');

    if (tabName === 'list') loadNotes();
}

function getRadioValue(name) {
    const radios = document.querySelectorAll('input[name="' + name + '"]');
    for (let radio of radios) {
        if (radio.checked) return parseInt(radio.value);
    }
    return null;
}

async function saveTastingNote(event) {
    event.preventDefault();

    if (!currentUser) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
        return;
    }

    const noteData = {
        user_id: currentUser.id,
        date: document.getElementById('date').value,
        sake_name: document.getElementById('sakeName').value,
        clarity_rating: getRadioValue('clarity_rating'),
        transparency: getRadioValue('transparency'),
        viscosity: getRadioValue('viscosity'),
        aroma_intensity: getRadioValue('aroma_intensity'),
        complexity_aroma: getRadioValue('complexity_aroma'),
        sharpness: getRadioValue('sharpness'),
        flavor: getRadioValue('flavor'),
        complexity_taste: getRadioValue('complexity_taste'),
        acidity: getRadioValue('acidity'),
        aftertaste: getRadioValue('aftertaste'),
        dominant_aroma: document.getElementById('dominant_aroma').value,
        dominant_taste: document.getElementById('dominant_taste').value,
        flavor_description: document.getElementById('flavor_description').value,
        personal_review: document.getElementById('personal_review').value,
        overall_rating: parseInt(document.getElementById('overall_rating').value)
    };

    try {
        if (editingNoteId) {
            const { error } = await supabaseClient.from('tasting_notes').update(noteData).eq('id', editingNoteId);
            if (error) throw error;
            alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
            editingNoteId = null;
        } else {
            const { error } = await supabaseClient.from('tasting_notes').insert([noteData]);
            if (error) throw error;
            alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
        }
        
        document.getElementById('tastingForm').reset();
        setDefaultDate();
        switchTab('list');
    } catch (error) {
        alert('ì €ì¥ ì‹¤íŒ¨: ' + error.message);
    }
}

async function loadNotes() {
    try {
        const { data: notes, error } = await supabaseClient.from('tasting_notes').select('*').eq('user_id', currentUser.id).order('date', { ascending: false });
        
        if (error) throw error;

        let html = '';
        if (!notes || notes.length === 0) {
            html = '<div class="empty-state"><div class="empty-state-icon">ğŸ“</div><p>ì €ì¥ëœ ë…¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>';
        } else {
            notes.forEach(note => {
                html += '<div class="note-card" onclick="viewNote(' + note.id + ')"><div class="note-card-title">' + note.sake_name + '</div><div class="note-card-date">' + note.date + '</div></div>';
            });
        }

        document.getElementById('notesList').innerHTML = html;
    } catch (error) {
        alert('ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
    }
}

async function viewNote(id) {
    try {
        const { data: notes, error } = await supabaseClient.from('tasting_notes').select('*').eq('id', id);
        
        if (error) throw error;
        
        const note = notes[0];
        let html = '<div class="detail-section"><div class="detail-label">ì‚¬ì¼€ ì´ë¦„</div><div class="detail-value">' + note.sake_name + '</div></div>';
        html += '<div class="detail-section"><div class="detail-label">ë‚ ì§œ</div><div class="detail-value">' + note.date + '</div></div>';
        
        if (note.clarity_rating) html += '<div class="detail-section"><div class="detail-label">ìƒ‰ê°</div><div class="detail-value">' + note.clarity_rating + '/5</div></div>';
        if (note.transparency) html += '<div class="detail-section"><div class="detail-label">íˆ¬ëª…ë„</div><div class="detail-value">' + note.transparency + '/5</div></div>';
        if (note.viscosity) html += '<div class="detail-section"><div class="detail-label">ì ë„</div><div class="detail-value">' + note.viscosity + '/5</div></div>';
        if (note.aroma_intensity) html += '<div class="detail-section"><div class="detail-label">í–¥ ê°•ë„</div><div class="detail-value">' + note.aroma_intensity + '/5</div></div>';
        if (note.complexity_aroma) html += '<div class="detail-section"><div class="detail-label">í–¥ ë³µí•©ë„</div><div class="detail-value">' + note.complexity_aroma + '/5</div></div>';
        if (note.sharpness) html += '<div class="detail-section"><div class="detail-label">í–¥ ì„ ëª…ë„</div><div class="detail-value">' + note.sharpness + '/5</div></div>';
        if (note.flavor) html += '<div class="detail-section"><div class="detail-label">ë§›ì˜ ê°•ë„</div><div class="detail-value">' + note.flavor + '/5</div></div>';
        if (note.complexity_taste) html += '<div class="detail-section"><div class="detail-label">ë§› ë³µí•©ë„</div><div class="detail-value">' + note.complexity_taste + '/5</div></div>';
        if (note.acidity) html += '<div class="detail-section"><div class="detail-label">ì‚°ë¯¸</div><div class="detail-value">' + note.acidity + '/5</div></div>';
        if (note.aftertaste) html += '<div class="detail-section"><div class="detail-label">ì—¬ìš´</div><div class="detail-value">' + note.aftertaste + '/5</div></div>';
        
        if (note.dominant_aroma) html += '<div class="detail-section"><div class="detail-label">ì£¼ì²´ê°€ ë˜ëŠ” í–¥</div><div class="detail-value">' + note.dominant_aroma + '</div></div>';
        if (note.dominant_taste) html += '<div class="detail-section"><div class="detail-label">ì£¼ì²´ê°€ ë˜ëŠ” ë§›</div><div class="detail-value">' + note.dominant_taste + '</div></div>';
        if (note.flavor_description) html += '<div class="detail-section"><div class="detail-label">í–¥ë¯¸ ì„¤ëª…</div><div class="detail-value">' + note.flavor_description + '</div></div>';
        
        if (note.personal_review) {
            html += '<div class="detail-section"><div class="detail-label">ê°œì¸ì ì¸ ê°ìƒí‰</div><div class="detail-value">' + note.personal_review;
            if (note.overall_rating) html += '<div style="margin-top: 10px; font-weight: bold;">â­ ' + note.overall_rating + ' / 10</div>';
            html += '</div></div>';
        }
        
        html += '<button class="btn btn-small edit-btn" onclick="editNote(' + note.id + ')">âœï¸ ìˆ˜ì •</button>';
        html += '<button class="btn btn-small delete-btn" onclick="deleteNote(' + note.id + ')">ğŸ—‘ï¸ ì‚­ì œ</button>';

        document.getElementById('detailContent').innerHTML = html;
        document.getElementById('detailTab').classList.add('active');
        document.getElementById('listTab').classList.remove('active');
        document.querySelectorAll('.tab')[1].classList.add('active');
    } catch (error) {
        alert('ì¡°íšŒ ì‹¤íŒ¨: ' + error.message);
    }
}

async function editNote(id) {
    try {
        const { data: notes, error } = await supabaseClient.from('tasting_notes').select('*').eq('id', id);
        if (error) throw error;
        
        const note = notes[0];
        editingNoteId = id;
        
        document.getElementById('date').value = note.date;
        document.getElementById('sakeName').value = note.sake_name;
        
        if (note.clarity_rating) document.querySelector('input[name="clarity_rating"][value="' + note.clarity_rating + '"]').checked = true;
        if (note.transparency) document.querySelector('input[name="transparency"][value="' + note.transparency + '"]').checked = true;
        if (note.viscosity) document.querySelector('input[name="viscosity"][value="' + note.viscosity + '"]').checked = true;
        if (note.aroma_intensity) document.querySelector('input[name="aroma_intensity"][value="' + note.aroma_intensity + '"]').checked = true;
        if (note.complexity_aroma) document.querySelector('input[name="complexity_aroma"][value="' + note.complexity_aroma + '"]').checked = true;
        if (note.sharpness) document.querySelector('input[name="sharpness"][value="' + note.sharpness + '"]').checked = true;
        if (note.flavor) document.querySelector('input[name="flavor"][value="' + note.flavor + '"]').checked = true;
        if (note.complexity_taste) document.querySelector('input[name="complexity_taste"][value="' + note.complexity_taste + '"]').checked = true;
        if (note.acidity) document.querySelector('input[name="acidity"][value="' + note.acidity + '"]').checked = true;
        if (note.aftertaste) document.querySelector('input[name="aftertaste"][value="' + note.aftertaste + '"]').checked = true;
        
        document.getElementById('dominant_aroma').value = note.dominant_aroma || '';
        document.getElementById('dominant_taste').value = note.dominant_taste || '';
        document.getElementById('flavor_description').value = note.flavor_description || '';
        document.getElementById('personal_review').value = note.personal_review || '';
        document.getElementById('overall_rating').value = note.overall_rating || 5;
        document.getElementById('ratingDisplay').textContent = note.overall_rating || 5;
        
        switchTab('new');
        window.scrollTo(0, 0);
    } catch (error) {
        alert('ìˆ˜ì • ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
    }
}

async function deleteNote(id) {
    if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

    try {
        const { error } = await supabaseClient.from('tasting_notes').delete().eq('id', id);
        if (error) throw error;
        alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        switchTab('list');
    } catch (error) {
        alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
    }
}

function toggleTheme() {
    document.body.classList.toggle('dark-mode');
    localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
}

async function checkAuth() {
    const { data: { user } } = await supabaseClient.auth.getUser();
    if (user) {
        currentUser = user;
        showApp();
    } else {
        showAuth();
    }
}

if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
}

window.addEventListener('load', checkAuth);
</script>
</body>
</html>
